<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport"
		content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link rel="stylesheet" href="./css/reset.css">
	<link rel="stylesheet" href="./css/detail-page.css">
	<link rel="stylesheet" href="./css/pop-windows.css">
	<link rel="stylesheet" href="./css/pop-windows-buy.css">
	<link rel="stylesheet" href="./css/swiper-bundle.min.css">
	<title>detail-page</title>
</head>

<body>
	<div class="bg">
		<div class="title relative">
			<a href="#">
				<img onclick="history.back()" class="back" src="./img/detail-page/detail-page (6).jpg" alt="">
			</a>
			<a href="#">
				<span class="commodity-text">商品</span>
			</a>
			<a href="#">
				<span class="detail-text">详情</span>
			</a>
			<a href="#">
				<img class="host-page" src="./img/detail-page/detail-page (4).jpg" alt="">
			</a>
			<a href="#">
				<img class="share" src="./img/detail-page/detail-page (5).jpg" alt="">
			</a>
		</div>
		<div class="bed-photo">
			<div class="swiper mySwiper">
				<div class="swiper-wrapper">
					<!-- <div class="swiper-slide">
						<a href="#">
							<img src="./img/detail-page/detail-page (7).jpg" alt="">
						</a>
					</div> -->
				</div>
				<div class="swiper-pagination"></div>
			</div>
		</div>
		<!-- <div class="introduce flex">
			<div>
				<div class="commodity-name">全棉色织绗缝多用件套</div>
				<div class="commodity-introduce">夏季凉被，冬季暖套，四季可用</div>
				<div class="price">￥599</div>
			</div>
			<div>
				<div class="evaluate-number">469</div>
				<div class="user-evaluate">用户评价</div>
				<div class="check">
					<a href="#">查看</a>
				</div>
			</div>
		</div>
		<div class="service">
			<div class="flex">
				<div class="num-select">规格数量选择</div>
				<a href="#">
					<img src="./img/detail-page/detail-page (8).jpg" alt="">
				</a>
			</div>
			<div class="flex">
				<span class="promotion">一个促销：</span>
				<span class="discount">120款爆品满3件8折</span>
				<a href="#">
					<img src="./img/detail-page/detail-page (8).jpg" alt="">
				</a>
			</div>
			<div class="flex">
				<div class="score">积分：购买最高可得59积分</div>
			</div>
			<div class="flex">
				<div class="service-s">服务：</div>
				<div class="sale-method">
					<div class="ser">30天无忧退换货</div>
					<div class="ser">48小时快速退款</div>
					<div class="ser">满88元免邮费 </div>
				</div>
				<a href="#">
					<img src="./img/detail-page/detail-page (8).jpg" alt="">
				</a>
			</div>
		</div>
		<div class="user-evaluates">
			<div class="flex">
				<div class="user-evaluates-num">用户评价：（536）</div>
				<a href="#">99.1%好评
					<img src="./img/detail-page/detail-page (8).jpg" alt="">
				</a>
			</div>
			<div class="user-flex">
				<a href="#">
					<img class="user-header" src="./img/detail-page/detail-page (1).jpg" alt="">
				</a>
				<span>username</span>
				<a href="#">
					<img src="./img/detail-page/detail-page (2).jpg" alt="">
				</a>
				<a href="#">
					<img src="./img/detail-page/detail-page (3).jpg" alt="">
				</a>
				<a href="#">
					<img src="./img/detail-page/detail-page (3).jpg" alt="">
				</a>
				<a href="#">
					<img src="./img/detail-page/detail-page (3).jpg" alt="">
				</a>
				<a href="#">
					<img src="./img/detail-page/detail-page (3).jpg" alt="">
				</a>
				<a href="#">
					<img src="./img/detail-page/detail-page (3).jpg" alt="">
				</a>


			</div>
			<div class="time">
				<span>2017.12.4 10：20</span>
				<span>灰紫：1.8M</span>
			</div>
			<div class="evaluate-text">质感相当不错，很舒服，本人比较喜欢</div>
			<div class="user-evaluate-pic">
				<a href="#">
					<img src="./img/detail-page/detail-page (9).jpg" alt="">
				</a>
			</div>
		</div>
		<div class="commodity-detail">
			<div class="commodity-detail-text">商品详情</div>
			<div>
				<img class="img" src="./img/detail-page/detail-page (10).jpg" alt="">
			</div>
			<div>
				<div class="text1">窗边响起一阵蝉鸣</div>
				<div class="text1">转身抱紧被子，夏日午后，正当酣睡</div>
			</div>
			<div>
				<img class="img" src="./img/detail-page/detail-page (11).jpg" alt="">
			</div>
			<div>
				<div class="text2">一被多用</div>
				<div class="text1">可以做春凉被的四件套</div>
			</div>
			<div class="img_flex">
				<div>
					<img src="./img/detail-page/detail-page (12).jpg" alt="">
				</div>
				<div>
					<img src="./img/detail-page/detail-page (13).jpg" alt="">
				</div>
			</div>

		</div> -->
	</div>
	<div class="bottom">
		<div>
			<a href="#">
				<img class="service1" src="./img/detail-page/detail-page (14).jpg" alt="">
			</a>
		</div>
		<div>
			<a href="./shopping_cart.html">
				<img class="service2" src="./img/detail-page/detail-page (15).jpg" alt="">
			</a>
		</div>
		<div>
			<a href="#">
				<img class="service3" src="./img/detail-page/detail-page (16).jpg" alt="">
			</a>
		</div>
		<div class="add-cart">
			<a href="#">
				<img src="./img/detail-page/bottom_37.jpg" alt="">
			</a>
		</div>
		<div class="buy">
			<a href="#">
				<img src="./img/detail-page/bottom_38.jpg" alt="">
			</a>
		</div>
	</div>

	<div class="window-position">
		<!-- <div class="flex">
			<div>
				<img src="./img/pop-windows/windows_03.jpg" alt="">
			</div>
			<div class="introduce">
				<div class="price">价格：￥599</div>
				<div class="select">请选择规格属性</div>
			</div>
			<button class="btn" type="button">×</button>
		</div> -->
		<div class="color">颜色</div>
		<div class="color-flex">
			<div class="colors">灰紫</div>
			<div class="colors">浅咖色</div>
		</div>
		<div class="size">尺寸</div>
		<div class="size-flex">
			<div class="sizes">1.2M</div>
			<div class="sizes">1.8M</div>
		</div>
		<div class="num">数量</div>
		<form>
			<button id="down" class="decrease" type="button">-</button>
			<input id="num" class="quantity" type="number" value="1">
			<button id="up" class="increase" type="button">+</button>
		</form>
		<script>
			// 查找元素
			var oUp = document.querySelector('.window-position #up');
			var oDown = document.querySelector('.window-position #down');
			var oNum = document.querySelector('.window-position #num');

			// 绑定事件
			// 增加
			oUp.onclick = function () {
				// 提取value值 并去除两头空格 .trim(), 此时是字符串，字符串不能正常运算
				var num = oNum.value.trim();
				// 转换成数字，正常运算
				var x = parseFloat(num);
				// 修改value：
				oNum.value = x + 1;
			}

			// 减号
			oDown.onclick = function () {
				// 提取value值 并去除两头空格 .trim(), 此时是字符串，字符串不能正常运算
				var num = oNum.value.trim();
				// 转换成数字，正常运算
				var x = parseFloat(num);
				// 只能减到1
				if (x <= 1) {
					return false;
				}
				// 修改value：
				oNum.value = x - 1;
			}
		</script>
		<button class="button" type="button">确认</button>
	</div>


	<div class="window_buy-position">
		<!-- <div class="flex">
			<div>
				<img src="./img/pop-windows/windows_03.jpg" alt="">
			</div>
			<div class="introduce">
				<div class="price">价格：￥599</div>
				<div class="select">请选择规格属性</div>
			</div>
			<button class="btn" type="button">×</button>
		</div> -->
		<div class="color">颜色</div>
		<div class="color-flex">
			<div class="colors">灰紫</div>
			<div class="colors">浅咖色</div>
		</div>
		<div class="size">尺寸</div>
		<div class="size-flex">
			<div class="sizes">1.2M</div>
			<div class="sizes">1.8M</div>
		</div>
		<div class="num">数量</div>
		<form>
			<button id="down" class="decrease" type="button">-</button>
			<input id="num" class="quantity" type="number" value="1">
			<button id="up" class="increase" type="button">+</button>
		</form>
		<script>
			// 查找元素
			var oUp_buy = document.querySelector('.window_buy-position #up');
			var oDown_buy = document.querySelector('.window_buy-position #down');
			var oNum_buy = document.querySelector('.window_buy-position #num');

			// 绑定事件
			// 增加
			oUp_buy.onclick = function () {
				// 提取value值 并去除两头空格 .trim(), 此时是字符串，字符串不能正常运算
				var num_buy = oNum_buy.value.trim();
				// 转换成数字，正常运算
				var x = parseFloat(num_buy);
				// 修改value：
				oNum_buy.value = x + 1;
			}

			// 减号
			oDown_buy.onclick = function () {
				// 提取value值 并去除两头空格 .trim(), 此时是字符串，字符串不能正常运算
				var num_buy = oNum_buy.value.trim();
				// 转换成数字，正常运算
				var x = parseFloat(num_buy);
				// 只能减到1
				if (x <= 1) {
					return false;
				}
				// 修改value：
				oNum_buy.value = x - 1;
			}
		</script>
		<button class="button" type="button">确认</button>
	</div>


	<script src="./js/swiper-bundle.min.js"></script>
	<script src="./js/axios.min.js"></script>
	<script src="/js/axios.config.js"></script>
	<script src="./js/utils.js"></script>



	<script>
		//查找插入位置
		var oBg = document.querySelector(".bg");
		var oPic = document.querySelector('.swiper-wrapper')
		var oWindows = document.querySelector(".window-position");
		var oWindows_buy = document.querySelector('.window_buy-position');
		//获取地址栏参数
		var id = params('id');
		var uid = sessionStorage.id;
		if (uid) {
			axios.get('/goods/detail', { params: { id: id, uid: uid } })
				.then(function (res) {
					// console.log(res)
					if (res.status) {
						// console.log(res);
						var goods_detail_imgs = ''
						//分割照片
						var imgs = res.data.slider.split(',');
						// console.log(imgs)
						imgs.forEach(function (item) {
							console.log(item)
							//处理成功---渲染数据---照片
							goods_detail_imgs += `
		<div class="swiper-slide">
			<a href="#">
				<img src="${item}" alt="">
			</a>
		</div>
                `;
						})


						var goods_detail = `
<div class="introduce flex">
<div>
	<div class="commodity-name">${res.data.name}</div>
	<div class="commodity-introduce">夏季凉被，冬季暖套，四季可用</div>
	<div class="price">￥${res.data.price}</div>
</div>
<div>
	<div class="evaluate-number">469</div>
	<div class="user-evaluate">用户评价</div>
	<div class="check">
		<a href="#">查看</a>
	</div>
</div>
</div>
<div class="service">
<div class="flex">
	<div class="num-select">规格数量选择</div>
	<a href="#">
		<img src="./img/detail-page/detail-page (8).jpg" alt="">
	</a>
</div>
<div class="flex">
	<span class="promotion">一个促销：</span>
	<span class="discount">120款爆品满3件8折</span>
	<a href="#">
		<img src="./img/detail-page/detail-page (8).jpg" alt="">
	</a>
</div>
<div class="flex">
	<div class="score">积分：购买最高可得59积分</div>
</div>
<div class="flex">
	<div class="service-s">服务：</div>
	<div class="sale-method">
		<div class="ser">30天无忧退换货</div>
		<div class="ser">48小时快速退款</div>
		<div class="ser">满88元免邮费 </div>
	</div>
	<a href="#">
		<img src="./img/detail-page/detail-page (8).jpg" alt="">
	</a>
</div>
</div>
<div class="user-evaluates">
<div class="flex">
	<div class="user-evaluates-num">用户评价：（536）</div>
	<a href="#">99.1%好评
		<img src="./img/detail-page/detail-page (8).jpg" alt="">
	</a>
</div>
<div class="user-flex">
	<a href="#">
		<img class="user-header" src="./img/detail-page/detail-page (1).jpg" alt="">
	</a>
	<span>username</span>
	<a href="#">
		<img src="./img/detail-page/detail-page (2).jpg" alt="">
	</a>
	<a href="#">
		<img src="./img/detail-page/detail-page (3).jpg" alt="">
	</a>
	<a href="#">
		<img src="./img/detail-page/detail-page (3).jpg" alt="">
	</a>
	<a href="#">
		<img src="./img/detail-page/detail-page (3).jpg" alt="">
	</a>
	<a href="#">
		<img src="./img/detail-page/detail-page (3).jpg" alt="">
	</a>
	<a href="#">
		<img src="./img/detail-page/detail-page (3).jpg" alt="">
	</a>

</div>
<div class="time">
	<span>2017.12.4 10：20</span>
	<span>灰紫：1.8M</span>
</div>
<div class="evaluate-text">质感相当不错，很舒服，本人比较喜欢</div>
<div class="user-evaluate-pic">
	<a href="#">
		<img src="${res.data.img_md}" alt="">
	</a>
</div>
</div>
<div class="commodity-detail">
<div class="commodity-detail-text">商品详情</div>
<div>
	<img class="img" src="${imgs[0]}" alt="">
</div>
<div>
	<div class="text1">窗边响起一阵蝉鸣</div>
	<div class="text1">转身抱紧被子，夏日午后，正当酣睡</div>
</div>
<div>
	<img class="img" src="${imgs[1]}" alt="">
</div>
<div>
	<div class="text2">一被多用</div>
	<div class="text1">可以做春凉被的四件套</div>
</div>
<div class="img_flex">
	<div>
		<img src="${imgs[0]}" alt="">
	</div>
	<div>
		<img src="${imgs[1]}" alt="">
	</div>
</div>

</div>
`;
						var win_property = `
       <div class="flex">
			<div>
				<img src="${res.data.img_md}" alt="">
			</div>
			<div class="introduce">
				<div class="price">价格：￥${res.data.price}</div>
				<div class="select">${res.data.name}</div>
			</div>
			<button class="btn" type="button">×</button>
		</div>
`;
						var win_buy_property = `
       <div class="flex">
			<div>
				<img src="${res.data.img_md}" alt="">
			</div>
			<div class="introduce">
				<div class="price">价格：￥${res.data.price}</div>
				<div class="select">${res.data.name}</div>
			</div>
			<button class="btn_buy" type="button">×</button>
		</div>
`;

						oPic.insertAdjacentHTML('beforeend', goods_detail_imgs);
						oBg.insertAdjacentHTML('beforeend', goods_detail);
						oWindows.insertAdjacentHTML("afterbegin", win_property);
						oWindows_buy.insertAdjacentHTML("afterbegin", win_buy_property);
					}


					//弹窗叉号
					var oCancel = document.querySelector(".flex .btn")
					oCancel.addEventListener('click', function () {
						oWindows.style.display = "none";
					})

					//弹窗叉号
					var oCancel_buy = document.querySelector(".flex .btn_buy")
					oCancel_buy.addEventListener('click', function () {
						oWindows_buy.style.display = "none";
					})



					//进入时判断是否已经收藏该商品
					var oCollect = document.querySelector('.service3');
					if (res.data.isCollected) {
						oCollect.src = "./img/detail-page/已收藏.png"

					} else {
						oCollect.src = "./img/detail-page/detail-page (16).jpg"
					}

					//收藏---点击---按钮
					// console.log(oCollect.src)
					oCollect.addEventListener('click', function () {
						if (res.data.isCollected) {
							axios.post('/collection/remove', { id: id })
							oCollect.src = "./img/detail-page/detail-page (16).jpg"
							res.data.isCollected = false;

						} else {
							axios.post('/collection/add', { id: id })
							oCollect.src = "./img/detail-page/已收藏.png"
							res.data.isCollected = true;
						}
						// console.log(res)
						// console.log(oCollect.src)
					})


				})
		}

	</script>

	<script>

		//获取“加入购物车”
		var oCart = document.querySelector(".add-cart");
		var oBuy = document.querySelector(".buy");
		var oWindows = document.querySelector(".window-position");
		//绑定事件
		oCart.addEventListener('click', function (item) {
			oWindows.style.display = "block";
		});
		oBuy.addEventListener('click', function (item) {
			oWindows_buy.style.display = "block";
		});


		//加入购物车的确认按钮---提交商品id和数量
		var oButton = document.querySelector('.window-position .button')
		var oValueNumber = document.querySelector('.window-position #num')
		oButton.addEventListener('click', function (item) {
			var value_number = oValueNumber.value;
			axios.post('/cart/add', { gid: id, num: value_number })
				.then(function (res) {
					if (res.status)
						console.dir(res);
				})
		});

		//立即购买的确认按钮---跳转支付页面
		var oButton_buy = document.querySelector('.window_buy-position .button')
		oButton_buy.addEventListener('click', function (item) {
			location.assign('./pay.html');
		})


	</script>

	<script>
		var swiper = new Swiper(".mySwiper", {
			loop: true,
			pagination: {
				el: ".swiper-pagination",
			},
		});
	</script>

</body>

</html>